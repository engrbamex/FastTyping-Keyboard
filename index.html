<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Typing Keyboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for Light Mode */
        :root {
            --body-bg-gradient-start: #e0e7ff;
            --body-bg-gradient-end: #c3daff;
            --body-pattern-color: #d0d8ff;
            --container-bg: #ffffff;
            --container-border: #d1d5db;
            --heading-color: #2563eb;
            --text-display-bg: #f1f5f9;
            --text-display-border: #cbd5e1;
            --text-display-text-color: #334155;
            --input-field-border: #94a3b8;
            --input-field-text-color: #1f2937;
            --stats-bg: #f8fafc;
            --stats-border: #e2e8f0;
            --stats-text-color: #4b5563;
            --stats-value-color: #1e293b;
            --button-bg: #3b82f6;
            --button-hover-bg: #2563eb;
            --button-active-bg: #1d4ed8;
            --message-box-bg: #fff;
            --message-box-text-color: #1e293b;
            --keyboard-container-bg: #f1f5f9;
            --keyboard-container-border: #e2e8f0;
            --keyboard-key-bg: #e2e8f0;
            --keyboard-key-color: #334155;
            --keyboard-key-border: #cbd5e1;
            --keyboard-key-highlight: #60a5fa;
            --keyboard-key-highlight-border: #3b82f6;
            --keyboard-key-pressed: #3b82f6;
            --keyboard-key-pressed-border: #2563eb;
            --home-row-bg: #facc15;
            --home-row-color: #422006;
            --hand-guidance-color: #475569;
            --hand-guidance-strong-color: #1e293b;
            --hand-guidance-bg: #f8fafc;
            --hand-guidance-border: #e2e8f0;
            --level-select-label: #334155;
            --level-select-border: #94a3b8;
            --level-select-bg: white;
            --tutor-speaking-bg: #dbeafe;
            --tutor-speaking-color: #1e40af;
            --tutor-speaking-border: #bfdbfe;
            --tutor-speaking-dot: #3b82f6;
        }

        /* Dark Mode */
        body.dark-mode {
            --body-bg-gradient-start: #1a202c; /* Darker start */
            --body-bg-gradient-end: #2d3748;   /* Darker end */
            --body-pattern-color: #334155; /* Darker pattern */
            --container-bg: #2d3748; /* Dark container */
            --container-border: #4a5568;
            --heading-color: #63b3ed; /* Lighter blue for dark mode heading */
            --text-display-bg: #4a5568; /* Darker text area */
            --text-display-border: #606f8b;
            --text-display-text-color: #e2e8f0; /* Light text */
            --input-field-border: #606f8b;
            --input-field-text-color: #e2e8f0;
            --stats-bg: #4a5568;
            --stats-border: #606f8b;
            --stats-text-color: #e2e8f0;
            --stats-value-color: #f7fafc;
            --button-bg: #4299e1; /* Lighter blue button */
            --button-hover-bg: #3182ce;
            --button-active-bg: #2b6cb0;
            --message-box-bg: #4a5568;
            --message-box-text-color: #e2e8f0;
            --keyboard-container-bg: #4a5568;
            --keyboard-container-border: #606f8b;
            --keyboard-key-bg: #606f8b;
            --keyboard-key-color: #e2e8f0;
            --keyboard-key-border: #718096;
            --keyboard-key-highlight: #63b3ed;
            --keyboard-key-highlight-border: #4299e1;
            --keyboard-key-pressed: #4299e1;
            --keyboard-key-pressed-border: #3182ce;
            --home-row-bg: #f6ad55; /* Orange-yellow for dark mode home row */
            --home-row-color: #2d3748;
            --hand-guidance-color: #cbd5e1;
            --hand-guidance-strong-color: #f7fafc;
            --hand-guidance-bg: #4a5568;
            --hand-guidance-border: #606f8b;
            --level-select-label: #e2e8f0;
            --level-select-border: #606f8b;
            --level-select-bg: #4a5568;
            --tutor-speaking-bg: #3182ce;
            --tutor-speaking-color: #fff;
            --tutor-speaking-border: #2b6cb0;
            --tutor-speaking-dot: #90cdf4;
        }

        /* Base styles using variables */
        body {
            font-family: 'Inter', sans-serif;
            background:
                linear-gradient(135deg, var(--body-bg-gradient-start) 0%, var(--body-bg-gradient-end) 100%),
                repeating-linear-gradient(
                    0deg,
                    var(--body-pattern-color) 0px,
                    var(--body-pattern-color) 2px,
                    transparent 2px,
                    transparent 22px
                ),
                repeating-linear-gradient(
                    90deg,
                    var(--body-pattern-color) 0px,
                    var(--body-pattern-color) 2px,
                    transparent 2px,
                    transparent 32px
                );
            background-blend-mode: overlay, normal, normal;
            background-size: auto, 30px 30px, 40px 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.5s ease; /* Smooth transition for theme change */
        }
        .container {
            background-color: var(--container-bg);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-width: 800px;
            width: 100%;
            text-align: center;
            border: 1px solid var(--container-border);
            transition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
            position: relative; /* For absolute positioning of toggles */
        }
        h1 {
            color: var(--heading-color);
            font-weight: 800;
            margin-bottom: 30px;
            transition: color 0.5s ease;
        }

        /* Text Display Area */
        .text-display {
            background-color: var(--text-display-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-size: 1.5rem;
            line-height: 1.9;
            text-align: left;
            min-height: 140px;
            overflow-y: auto;
            border: 2px solid var(--text-display-border);
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.08);
            user-select: none;
            color: var(--text-display-text-color);
            transition: background-color 0.5s ease, border-color 0.5s ease, color 0.5s ease;
        }
        .text-display span {
            transition: background-color 0.1s, color 0.1s;
            display: inline-block;
            padding: 0 2px;
        }
        .correct {
            color: #15803d; /* Specific color, usually doesn't change with theme */
        }
        .incorrect {
            background-color: #dc2626; /* Specific color */
            color: #ffffff;
            border-radius: 4px;
        }
        .current {
            background-color: var(--keyboard-key-highlight); /* Uses highlight color */
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); /* Shadow remains consistent */
        }

        /* User Input Field */
        .input-field {
            width: 100%;
            padding: 18px 25px;
            border: 2px solid var(--input-field-border);
            border-radius: 12px;
            font-size: 1.4rem;
            margin-bottom: 30px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.08);
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.5s ease, color 0.5s ease;
            color: var(--input-field-text-color);
            background-color: var(--text-display-bg); /* Use text display bg for input */
        }
        .input-field:focus {
            outline: none;
            border-color: var(--button-bg);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.4);
        }

        /* Stats Section */
        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            font-size: 1.3rem;
            color: var(--stats-text-color);
            flex-wrap: wrap;
            gap: 20px;
            transition: color 0.5s ease;
        }
        .stats div {
            padding: 12px 20px;
            background-color: var(--stats-bg);
            border-radius: 10px;
            border: 1px solid var(--stats-border);
            min-width: 140px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        .stats span {
            font-weight: 700;
            color: var(--stats-value-color);
            transition: color 0.5s ease;
        }

        /* Button Group */
        .button-group button {
            background-color: var(--button-bg);
            color: white;
            padding: 16px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 18px rgba(59, 130, 246, 0.35);
            margin: 8px;
        }
        .button-group button:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.45);
        }
        .button-group button:active {
            background-color: var(--button-active-bg);
            transform: translateY(0);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Message Box */
        .message-box {
            background-color: var(--message-box-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
            font-size: 1.3rem;
            color: var(--message-box-text-color);
            max-width: 450px;
            width: 90%;
            animation: fadeIn 0.3s ease-out;
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        .message-box p {
            margin-bottom: 25px;
        }
        .message-box button {
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        .message-box button:hover {
            opacity: 0.9;
        }
        #messageBoxOk {
            background-color: var(--button-bg);
        }
        /* Removed messageBoxYes and messageBoxNo specific styling as they are removed */
        .overlay {
            background: rgba(0, 0, 0, 0.6);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            display: none; /* Hidden by default */
        }

        /* Virtual Keyboard Styles */
        .keyboard-container {
            background-color: var(--keyboard-container-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid var(--keyboard-container-border);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 7px;
        }
        .keyboard-key {
            background-color: var(--keyboard-key-bg);
            color: var(--keyboard-key-color);
            padding: 12px 14px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            min-width: 50px;
            text-align: center;
            cursor: default;
            user-select: none;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.1s, transform 0.05s, box-shadow 0.1s, color 0.1s, border-color 0.1s;
            border: 1px solid var(--keyboard-key-border);
        }
        .keyboard-key.wide {
            min-width: 90px;
        }
        .keyboard-key.extra-wide {
            min-width: 110px;
        }
        .keyboard-key.space {
            min-width: 350px;
        }

        /* Key highlight for current character */
        .keyboard-key.highlight-current {
            background-color: var(--keyboard-key-highlight);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(96, 165, 250, 0.5);
            border-color: var(--keyboard-key-highlight-border);
        }

        /* Key pressed effect */
        .keyboard-key.key-pressed {
            background-color: var(--keyboard-key-pressed);
            color: white;
            transform: translateY(0);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            border-color: var(--keyboard-key-pressed-border);
        }

        /* Home row keys */
        .keyboard-key[data-key="f"],
        .keyboard-key[data-key="j"] {
            background-color: var(--home-row-bg);
            color: var(--home-row-color);
            box-shadow: 0 3px 6px rgba(250, 204, 21, 0.4);
        }

        /* Hand placement guidance */
        .hand-guidance {
            font-size: 1rem;
            color: var(--hand-guidance-color);
            margin-top: 20px;
            margin-bottom: 20px;
            line-height: 1.6;
            text-align: left;
            background-color: var(--hand-guidance-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--hand-guidance-border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: background-color 0.5s ease, border-color 0.5s ease, color 0.5s ease;
        }
        .hand-guidance strong {
            color: var(--hand-guidance-strong-color);
            transition: color 0.5s ease;
        }

        /* Level Selector */
        .level-selector {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .level-selector label {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--level-select-label);
            transition: color 0.5s ease;
        }
        .level-selector select {
            padding: 12px 20px;
            border: 2px solid var(--level-select-border);
            border-radius: 10px;
            font-size: 1.2rem;
            background-color: var(--level-select-bg);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath fill='%236B7280' d='M9.293 12.95l.707.707L15 8.172l-1.414-1.414L10 10.343l-3.586-3.585L5 8.172z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 1.4em;
            cursor: pointer;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.5s ease;
        }
        .level-selector select:focus {
            outline: none;
            border-color: var(--button-bg);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.4);
        }

        /* Removed gameCanvas styles as the element is removed */

        /* Tutor speaking indicator */
        #tutorSpeaking {
            background-color: var(--tutor-speaking-bg);
            color: var(--tutor-speaking-color);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            border: 1px solid var(--tutor-speaking-border);
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }
        #tutorSpeaking .dot {
            width: 8px;
            height: 8px;
            background-color: var(--tutor-speaking-dot);
            border-radius: 50%;
            display: inline-block;
            animation: pulse 1.5s infinite ease-in-out;
            transition: background-color 0.5s ease;
        }
        #tutorSpeaking .dot:nth-child(2) { animation-delay: 0.2s; }
        #tutorSpeaking .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        /* Keyframe for fadeIn animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        /* Toggle Switches */
        .toggle-container {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Round sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        .toggle-label {
            color: var(--text-display-text-color);
            font-size: 0.9rem;
            margin-right: 10px;
            font-weight: 600;
            transition: color 0.5s ease;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }
            .text-display {
                font-size: 1.2rem;
                padding: 20px;
                min-height: 100px;
            }
            .input-field {
                font-size: 1.2rem;
                padding: 15px 20px;
            }
            .stats {
                gap: 10px;
            }
            .stats div {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 1.1rem;
            }
            .button-group button {
                padding: 14px 28px;
                font-size: 1.1rem;
            }
            .keyboard-key {
                min-width: 40px;
                font-size: 0.95rem;
                padding: 10px 10px;
            }
            .keyboard-key.wide {
                min-width: 70px;
            }
            .keyboard-key.extra-wide {
                min-width: 90px;
            }
            .keyboard-key.space {
                min-width: 250px;
            }
            .keyboard-container {
                padding: 20px;
                gap: 8px;
            }
            .keyboard-row {
                gap: 5px;
            }
            .hand-guidance {
                font-size: 0.9rem;
                padding: 15px;
            }
            .level-selector label {
                font-size: 1.1rem;
            }
            .level-selector select {
                font-size: 1.1rem;
                padding: 10px 15px;
            }
            /* Removed gameCanvas responsiveness */
            #tutorSpeaking {
                font-size: 1rem;
                padding: 8px 15px;
            }
            .toggle-container {
                top: 10px;
                right: 10px;
                flex-direction: row;
                gap: 5px;
            }
            .toggle-label {
                font-size: 0.8rem;
                margin-right: 5px;
            }
            .toggle-switch {
                width: 45px;
                height: 26px;
            }
            .slider:before {
                height: 20px;
                width: 20px;
                left: 3px;
                bottom: 3px;
            }
            input:checked + .slider:before {
                transform: translateX(19px);
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 15px;
                border-radius: 15px;
            }
            h1 {
                font-size: 2.2rem;
                margin-bottom: 20px;
            }
            .text-display {
                font-size: 1rem;
                line-height: 1.5;
                padding: 15px;
                min-height: 80px;
                margin-bottom: 20px;
            }
            .input-field {
                font-size: 1.1rem;
                padding: 12px 15px;
                margin-bottom: 20px;
            }
            .stats {
                flex-direction: column;
                align-items: center;
                gap: 10px;
                margin-bottom: 20px;
            }
            .stats div {
                width: 90%;
                min-width: auto;
            }
            .button-group button {
                padding: 10px 20px;
                font-size: 1rem;
                margin: 5px;
            }
            .level-selector {
                flex-direction: column;
                gap: 8px;
                margin-bottom: 15px;
            }
            .level-selector select {
                width: 100%;
                max-width: 200px;
                font-size: 1rem;
                padding: 8px 12px;
            }
            .keyboard-key {
                min-width: 28px;
                font-size: 0.75rem;
                padding: 5px 6px;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            }
            .keyboard-key.wide {
                min-width: 45px;
            }
            .keyboard-key.extra-wide {
                min-width: 60px;
            }
            .keyboard-key.space {
                min-width: 120px;
            }
            .keyboard-container {
                padding: 15px;
                gap: 6px;
                margin-bottom: 20px;
            }
            .keyboard-row {
                gap: 3px;
            }
            .hand-guidance {
                font-size: 0.8rem;
                padding: 10px;
                margin-top: 10px;
                margin-bottom: 10px;
            }
            /* Removed gameCanvas responsiveness */
            .message-box {
                padding: 20px;
                font-size: 1rem;
            }
            #tutorSpeaking {
                font-size: 0.9rem;
                padding: 6px 10px;
            }
            .toggle-container {
                position: static; /* Remove absolute positioning on very small screens */
                flex-direction: column;
                margin-bottom: 10px;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Toggle Switches Container -->
        <div class="toggle-container">
            <!-- Removed Game Toggle -->
            <!-- Dark Mode Toggle -->
            <label class="flex items-center cursor-pointer">
                <span class="toggle-label mr-2">Dark Mode</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle" class="hidden">
                    <span class="slider round"></span>
                </div>
            </label>
        </div>

        <h1 class="text-4xl font-extrabold mb-6">Fast Typing Keyboard</h1>

        <!-- Level Selector -->
        <div class="level-selector">
            <label for="levelSelect">Choose Level:</label>
            <select id="levelSelect" class="cursor-pointer">
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
            </select>
        </div>

        <!-- Hand Placement Guidance -->
        <div class="hand-guidance">
            <p><strong>Hand Placement Guide:</strong></p>
            <ul class="list-disc list-inside mt-2 text-sm">
                <li>Place your left index finger on <strong class="text-yellow-600">F</strong> and right index finger on <strong class="text-yellow-600">J</strong> (these keys often have a small bump).</li>
                <li>Your other fingers should naturally rest on the keys next to them:
                    <ul class="list-disc list-inside ml-4">
                        <li>Left hand: Pinky on A, Ring on S, Middle on D, Index on F.</li>
                        <li>Right hand: Index on J, Middle on K, Ring on L, Pinky on ; (semicolon).</li>
                    </ul>
                </li>
                <li>Thumbs rest lightly on the **Spacebar**.</li>
                <li>Always return your fingers to the home row after striking a key.</li>
            </ul>
        </div>

        <!-- Virtual Keyboard Display -->
        <div class="keyboard-container">
            <div class="keyboard-row">
                <span class="keyboard-key" data-key="`">`</span>
                <span class="keyboard-key" data-key="1">1</span>
                <span class="keyboard-key" data-key="2">2</span>
                <span class="keyboard-key" data-key="3">3</span>
                <span class="keyboard-key" data-key="4">4</span>
                <span class="keyboard-key" data-key="5">5</span>
                <span class="keyboard-key" data-key="6">6</span>
                <span class="keyboard-key" data-key="7">7</span>
                <span class="keyboard-key" data-key="8">8</span>
                <span class="keyboard-key" data-key="9">9</span>
                <span class="keyboard-key" data-key="0">0</span>
                <span class="keyboard-key" data-key="-">-</span>
                <span class="keyboard-key" data-key="=">=</span>
                <span class="keyboard-key wide" data-key="backspace">Backspace</span>
            </div>
            <div class="keyboard-row">
                <span class="keyboard-key wide" data-key="tab">Tab</span>
                <span class="keyboard-key" data-key="q">Q</span>
                <span class="keyboard-key" data-key="w">W</span>
                <span class="keyboard-key" data-key="e">E</span>
                <span class="keyboard-key" data-key="r">R</span>
                <span class="keyboard-key" data-key="t">T</span>
                <span class="keyboard-key" data-key="y">Y</span>
                <span class="keyboard-key" data-key="u">U</span>
                <span class="keyboard-key" data-key="i">I</span>
                <span class="keyboard-key" data-key="o">O</span>
                <span class="keyboard-key" data-key="p">P</span>
                <span class="keyboard-key" data-key="[">[</span>
                <span class="keyboard-key" data-key="]">]</span>
                <span class="keyboard-key wide" data-key="\-backslash">\</span>
            </div>
            <div class="keyboard-row">
                <span class="keyboard-key wide" data-key="capslock">Caps Lock</span>
                <span class="keyboard-key" data-key="a">A</span>
                <span class="keyboard-key" data-key="s">S</span>
                <span class="keyboard-key" data-key="d">D</span>
                <span class="keyboard-key" data-key="f">F</span>
                <span class="keyboard-key" data-key="g">G</span>
                <span class="keyboard-key" data-key="h">H</span>
                <span class="keyboard-key" data-key="j">J</span>
                <span class="keyboard-key" data-key="k">K</span>
                <span class="keyboard-key" data-key="l">L</span>
                <span class="keyboard-key" data-key=";">;</span>
                <span class="keyboard-key" data-key="'">'</span>
                <span class="keyboard-key wide" data-key="enter">Enter</span>
            </div>
            <div class="keyboard-row">
                <span class="keyboard-key extra-wide" data-key="shift-left">Shift</span>
                <span class="keyboard-key" data-key="z">Z</span>
                <span class="keyboard-key" data-key="x">X</span>
                <span class="keyboard-key" data-key="c">C</span>
                <span class="keyboard-key" data-key="v">V</span>
                <span class="keyboard-key" data-key="b">B</span>
                <span class="keyboard-key" data-key="n">N</span>
                <span class="keyboard-key" data-key="m">M</span>
                <span class="keyboard-key" data-key=",">,</span>
                <span class="keyboard-key" data-key=".">.</span>
                <span class="keyboard-key" data-key="/">/</span>
                <span class="keyboard-key extra-wide" data-key="shift-right">Shift</span>
            </div>
            <div class="keyboard-row">
                <span class="keyboard-key wide" data-key="control-left">Ctrl</span>
                <span class="keyboard-key wide" data-key="alt-left">Alt</span>
                <span class="keyboard-key space" data-key=" ">Space</span>
                <span class="keyboard-key wide" data-key="alt-right">Alt</span>
                <span class="keyboard-key wide" data-key="control-right">Ctrl</span>
            </div>
        </div>

        <!-- Removed Game Canvas -->

        <!-- Text Display Area -->
        <div id="textDisplay" class="text-display"></div>

        <!-- User Input Field -->
        <input type="text" id="typingInput" class="input-field" placeholder="Start typing here..." autofocus disabled>

        <!-- Stats Section -->
        <div class="stats">
            <div>WPM: <span id="wpm">0</span></div>
            <div>Accuracy: <span id="accuracy">100%</span></div>
            <div>Time: <span id="timer">0s</span></div>
            <div>Errors: <span id="errors">0</span></div>
        </div>

        <!-- Control Buttons -->
        <div class="button-group">
            <button id="startButton">Start Test</button>
        </div>
    </div>

    <!-- Message Box for Alerts -->
    <div id="overlay" class="overlay"></div>
    <div id="messageBox" class="message-box hidden">
        <p id="messageText"></p>
        <div id="messageBoxButtons" class="flex justify-center gap-4 mt-4">
            <button id="messageBoxOk" class="px-5 py-2 rounded-lg text-white">OK</button>
            <!-- Removed Yes/No buttons -->
        </div>
    </div>

    <!-- Tutor Speaking Indicator -->
    <div id="tutorSpeaking" class="absolute top-4 right-4 flex hidden items-center justify-center">
        <span class="text-sm mr-2">Tutor is speaking...</span>
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
    </div>

    <script>
        // Sentences for different typing levels
        const levelSentences = {
            beginner: [
                "a s d f j k l ;",
                "a a a s s s d d d",
                "f j f j k l k l",
                "the and for is it",
                "a cat a dog a hat",
                "my pen my bag my book",
                "i am you are he is",
                "go go go no no no",
                "yes yes yes one two three",
                "red blue green yellow"
            ],
            intermediate: [
                "The quick brown fox jumps over the lazy dog.",
                "Never underestimate the power of a good book.",
                "Technology has revolutionized the way we live and work.",
                "The sun always shines brightest after the rain.",
                "Learning a new skill can open up many opportunities.",
                "Practice makes perfect, especially in typing.",
                "The early bird catches the worm.",
                "Innovation is the key to progress.",
                "Coding is a blend of logic and creativity.",
                "The mountains are calling and I must go."
            ],
            advanced: [
                "In the realm of artificial intelligence, machine learning algorithms continuously refine their predictive models based on vast datasets, leading to breakthroughs in various scientific disciplines.",
                "The unparalleled beauty of the Aurora Borealis, visible only in the extreme northern and southern latitudes, is a breathtaking celestial phenomenon caused by the collision of solar wind particles with Earth's magnetosphere.",
                "Quantum computing promises to revolutionize cryptography and drug discovery by leveraging the principles of superposition and entanglement, enabling calculations far beyond the capabilities of classical computers.",
                "Sustainable urban development integrates ecological principles with socioeconomic considerations to create resilient, livable cities that minimize environmental impact and promote community well-being.",
                "The intricacies of classical music composition often involve complex counterpoint, harmonic progressions, and thematic development, reflecting centuries of evolving artistic expression and theoretical innovation."
            ]
        };

        // Get DOM elements
        const textDisplay = document.getElementById('textDisplay');
        const typingInput = document.getElementById('typingInput');
        const wpmSpan = document.getElementById('wpm');
        const accuracySpan = document.getElementById('accuracy');
        const timerSpan = document.getElementById('timer');
        const errorsSpan = document.getElementById('errors');
        const startButton = document.getElementById('startButton');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxOk = document.getElementById('messageBoxOk');
        const overlay = document.getElementById('overlay');
        const levelSelect = document.getElementById('levelSelect');
        const keyboardKeys = document.querySelectorAll('.keyboard-key');
        const tutorSpeakingIndicator = document.getElementById('tutorSpeaking');
        const darkModeToggle = document.getElementById('darkModeToggle'); // Dark mode toggle remains

        // Game state variables (removed all game-specific ones)
        let currentText = '';
        let currentIndex = 0;
        let startTime = 0;
        let timerInterval = null;
        let totalTypedCharacters = 0;
        let correctCharacters = 0;
        let errors = 0;
        let testStarted = false;
        let currentLevel = 'beginner'; // Default level
        let previousTypedValueLength = 0;
        let firstTestEverStarted = false;

        // Removed game canvas variables and context

        /**
         * Shows a custom message box instead of alert().
         * @param {string} message The message to display.
         */
        function showMessageBox(message) { // Simplified, no game prompt logic
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            overlay.style.display = 'block';
            typingInput.disabled = true;
            startButton.disabled = true;
            darkModeToggle.disabled = true; // Still disable toggles
            // Removed game-specific buttons and logic
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            messageBox.classList.add('hidden');
            overlay.style.display = 'none';
            startButton.disabled = false;
            darkModeToggle.disabled = false; // Enable toggles after message box closes

            if (testStarted) {
                typingInput.disabled = false;
                typingInput.focus();
            } else {
                typingInput.disabled = true;
            }
        }

        // Event listener for message box buttons
        messageBoxOk.addEventListener('click', () => {
            hideMessageBox();
            if (!testStarted) {
                startButton.textContent = 'Continue Practice';
            }
        });

        // Removed messageBoxYes and messageBoxNo event listeners

        /**
         * Selects a random sentence based on the current level.
         * @returns {string} A random sentence from the selected level's list.
         */
        function getRandomSentenceForLevel() {
            const sentences = levelSentences[currentLevel];
            const randomIndex = Math.floor(Math.random() * sentences.length);
            return sentences[randomIndex];
        }

        /**
         * Clears all key highlights on the virtual keyboard.
         */
        function clearKeyHighlights() {
            keyboardKeys.forEach(key => {
                key.classList.remove('highlight-current', 'key-pressed');
            });
        }

        /**
         * Highlights the current character's key on the virtual keyboard.
         */
        function highlightCurrentKey() {
            clearKeyHighlights();
            if (currentIndex < currentText.length) {
                let charToHighlight = currentText[currentIndex];
                let keyElement = null;

                if (charToHighlight === charToHighlight.toUpperCase() && charToHighlight.match(/[A-Z]/)) {
                    keyElement = document.querySelector(`.keyboard-key[data-key="${charToHighlight.toLowerCase()}"]`);
                    document.querySelector('.keyboard-key[data-key="shift-left"]').classList.add('highlight-current');
                    document.querySelector('.keyboard-key[data-key="shift-right"]').classList.add('highlight-current');
                } else if (charToHighlight.match(/[!@#$%^&*()_+{}:"<>?~|]/)) {
                    const specialKeys = {
                        '!': '1', '@': '2', '#': '3', '$': '4', '%': '5', '^': '6', '&': '7', '*': '8', '(': '9', ')': '0',
                        '_': '-', '+': '=', '{': '[', '}': ']', ':': ';', '"': "'", '<': ',', '>': '.', '?': '/', '|': '\\-backslash'
                    };
                    const baseKey = specialKeys[charToHighlight];
                    if (baseKey) {
                        keyElement = document.querySelector(`.keyboard-key[data-key="${baseKey}"]`);
                        document.querySelector('.keyboard-key[data-key="shift-left"]').classList.add('highlight-current');
                        document.querySelector('.keyboard-key[data-key="shift-right"]').classList.add('highlight-current');
                    }
                } else if (charToHighlight === ' ') {
                     keyElement = document.querySelector(`.keyboard-key[data-key=" "]`);
                }
                else {
                    keyElement = document.querySelector(`.keyboard-key[data-key="${charToHighlight.toLowerCase()}"]`);
                }

                if (keyElement) {
                    keyElement.classList.add('highlight-current');
                }
            }
        }

        /**
         * Simulates a key press on the virtual keyboard.
         * @param {string} key The character or data-key value of the pressed key.
         */
        function simulateKeyPress(key) {
            let keyToPress = key.toLowerCase();
            if (key === ' ') {
                keyToPress = ' ';
            } else if (key === '\\') {
                keyToPress = '\\-backslash';
            }

            const keyElement = document.querySelector(`.keyboard-key[data-key="${keyToPress}"]`);
            if (keyElement) {
                keyElement.classList.add('key-pressed');
                setTimeout(() => {
                    keyElement.classList.remove('key-pressed');
                }, 150);
            }

            document.querySelector('.keyboard-key[data-key="shift-left"]').classList.remove('key-pressed');
            document.querySelector('.keyboard-key[data-key="shift-right"]').classList.remove('key-pressed');
        }

        /**
         * Renders the text in the display area, highlighting correct, incorrect, and current characters.
         */
        function renderText() {
            textDisplay.innerHTML = '';
            currentText.split('').forEach((char, index) => {
                const span = document.createElement('span');
                span.textContent = char;
                if (index < currentIndex) {
                    if (typingInput.value[index] === char) {
                        span.classList.add('correct');
                    } else {
                        span.classList.add('incorrect');
                    }
                } else if (index === currentIndex) {
                    span.classList.add('current');
                }
                textDisplay.appendChild(span);
            });
            const currentSpan = textDisplay.querySelector('.current');
            if (currentSpan) {
                const textDisplayRect = textDisplay.getBoundingClientRect();
                const currentSpanRect = currentSpan.getBoundingClientRect();

                if (currentSpanRect.top < textDisplayRect.top || currentSpanRect.bottom > textDisplayRect.bottom) {
                    textDisplay.scrollTop += currentSpanRect.top - textDisplayRect.top - (textDisplay.clientHeight / 3);
                }
            }
            highlightCurrentKey();
        }

        /**
         * Calculates and updates WPM and accuracy, including errors.
         */
        function updateStats() {
            const elapsedTime = (Date.now() - startTime) / 1000;
            timerSpan.textContent = `${Math.floor(elapsedTime)}s`;

            if (elapsedTime > 0) {
                const wordsTyped = correctCharacters / 5;
                const wpm = Math.round((wordsTyped / elapsedTime) * 60);
                wpmSpan.textContent = wpm;

                const accuracy = totalTypedCharacters === 0 ? 100 : Math.round((correctCharacters / totalTypedCharacters) * 100);
                accuracySpan.textContent = `${accuracy}%`;
                errorsSpan.textContent = errors;
            } else {
                wpmSpan.textContent = '0';
                accuracySpan.textContent = '100%';
                errorsSpan.textContent = '0';
            }
        }

        /**
         * Resets the game to its initial state, preparing for a new test.
         */
        function resetGame() {
            clearInterval(timerInterval);
            currentText = getRandomSentenceForLevel();
            currentIndex = 0;
            startTime = 0;
            totalTypedCharacters = 0;
            correctCharacters = 0;
            errors = 0;
            testStarted = false;
            previousTypedValueLength = 0;

            typingInput.value = '';
            typingInput.disabled = true;
            wpmSpan.textContent = '0';
            accuracySpan.textContent = '100%';
            timerSpan.textContent = '0s';
            errorsSpan.textContent = '0';
            startButton.textContent = 'Start Test';
            startButton.classList.remove('bg-green-600', 'hover:bg-green-700');
            startButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
            levelSelect.disabled = false;

            // Removed game-specific resets (e.g., gameSpeed, gameCanvas display)

            renderText();
        }

        /**
         * Starts the actual typing test.
         */
        function startActualTest() {
            if (!firstTestEverStarted) {
                speakWelcomeMessage();
                firstTestEverStarted = true;
            }

            resetGame(); // Ensure everything is clean for the new test
            testStarted = true;
            typingInput.disabled = false;
            typingInput.focus();
            startTime = Date.now();
            timerInterval = setInterval(updateStats, 1000);
            startButton.textContent = 'Reset Test';
            startButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            startButton.classList.add('bg-green-600', 'hover:bg-green-700');
            levelSelect.disabled = true;

            // Removed gameCanvas display logic
        }

        /**
         * Handles user input from the typing field, updating typing stats.
         * @param {Event} event The input event.
         */
        function handleInput(event) {
            if (!testStarted) return;

            const typedValue = typingInput.value;

            // Simulate key press on virtual keyboard
            if (event.data) {
                simulateKeyPress(event.data);
            }

            // Logic for updating correct/incorrect characters and index
            if (typedValue.length > previousTypedValueLength) {
                // No game speed update needed
            }

            correctCharacters = 0;
            errors = 0;
            for (let i = 0; i < typedValue.length; i++) {
                if (typedValue[i] === currentText[i]) {
                    correctCharacters++;
                } else {
                    errors++;
                }
            }

            currentIndex = typedValue.length;
            totalTypedCharacters = typedValue.length;
            previousTypedValueLength = typedValue.length;

            renderText();
            updateStats();

            // Check if the user has finished typing the entire text
            if (currentIndex === currentText.length && typedValue.length === currentText.length) {
                clearInterval(timerInterval);
                testStarted = false;
                typingInput.disabled = true;

                const finalWPM = wpmSpan.textContent;
                const finalAccuracy = accuracySpan.textContent;
                const finalErrors = errorsSpan.textContent;

                // Removed testsCompletedCount and game-related prompts

                clearKeyHighlights();
                // Removed game-related stops

                // Simply show the results message
                showMessageBox(`Test Finished! Your WPM: ${finalWPM}, Accuracy: ${finalAccuracy}, Errors: ${finalErrors}.`);
                startButton.textContent = 'Continue Practice'; // Always "Continue Practice" after a finished test
            }
        }

        // Removed all Game Canvas Drawing Functions (drawSky, drawCar, drawRoad, updateGameSpeed, gameLoop)

        // Utility functions for audio conversion (PCM to WAV)
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcm16, sampleRate) {
            const wavHeader = new ArrayBuffer(44);
            const view = new DataView(wavHeader);

            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcm16.length * 2, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true); // Mono
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, pcm16.length * 2, true);

            const blob = new Blob([wavHeader, pcm16], { type: 'audio/wav' });
            return blob;
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        async function speakWelcomeMessage() {
            const welcomeMessage = "Welcome to your online fast typing class! Let's get started.";

            tutorSpeakingIndicator.style.display = 'flex';

            const payload = {
                contents: [{
                    parts: [{ text: welcomeMessage }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Kore" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API request failed with status:', response.status, response.statusText, 'Response body:', errorText);
                    tutorSpeakingIndicator.textContent = `Tutor error: ${response.status} ${response.statusText}`;
                    setTimeout(() => tutorSpeakingIndicator.style.display = 'none', 3000);
                    return;
                }

                let result;
                try {
                    result = await response.json();
                } catch (jsonParseError) {
                    const rawText = await response.text();
                    console.error('Error parsing JSON from API response:', jsonParseError, 'Raw response content:', rawText);
                    tutorSpeakingIndicator.textContent = "Tutor error: Corrupted response data.";
                    setTimeout(() => tutorSpeakingIndicator.style.display = 'none', 3000);
                    return;
                }

                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 16000;

                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audio = new Audio(URL.createObjectURL(wavBlob));
                    audio.play();

                    audio.onended = () => {
                        tutorSpeakingIndicator.style.display = 'none';
                    };
                } else {
                    console.error('Error: Audio data or mime type missing from API response. Result:', result);
                    tutorSpeakingIndicator.textContent = "Tutor could not speak (no audio data).";
                    setTimeout(() => tutorSpeakingIndicator.style.display = 'none', 3000);
                }
            } catch (error) {
                console.error('Error calling TTS API (network/general fetch issue):', error);
                tutorSpeakingIndicator.textContent = "Tutor error: Network issue.";
                setTimeout(() => tutorSpeakingIndicator.style.display = 'none', 3000);
            }
        }


        // Event listener for the main Start/Reset button
        startButton.addEventListener('click', () => {
            if (testStarted) {
                resetGame();
            } else {
                startActualTest();
            }
        });

        typingInput.addEventListener('input', handleInput);

        levelSelect.addEventListener('change', (event) => {
            currentLevel = event.target.value;
            resetGame();
        });

        // Removed Game Toggle event listener

        // Event listener for Dark Mode Toggle
        darkModeToggle.addEventListener('change', () => {
            if (darkModeToggle.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            }
        });

        // Initialize the app when the page loads
        window.onload = function() {
            // Apply saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggle.checked = false;
            }

            // Removed setupCanvas as gameCanvas is removed
            resetGame(); // Ensure initial state is clean
            // Removed gameLoop call
        };

        // Removed Handle canvas resize
    </script>
</body>
</html>
